<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Uploader Gambar Blogger</title>

<style>
body{
  font-family:Arial,sans-serif;
  max-width:600px;
  margin:30px auto;
}
input,textarea,button{
  width:100%;
  margin:6px 0;
  padding:8px;
}
button{cursor:pointer}

#loader{
  display:none;
  text-align:center;
  margin:15px 0;
}

.spinner{
  width:40px;
  height:40px;
  border:4px solid #ddd;
  border-top:4px solid #4285f4;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}

img{
  max-width:100%;
  margin-top:10px;
  display:none;
}
</style>
</head>

<body>

<h3>Uploader Gambar Blogger</h3>

<input type="file" id="file" accept="image/*">
<input type="text" id="alt" placeholder="Alt text gambar">
<button onclick="upload()">Upload</button>

<div id="loader">
  <div class="spinner"></div>
  <small>Memuat gambarâ€¦</small>
</div>

<div id="result"></div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbyEILX-K9CBTdmyTl7odypaddzXoPu-LC0rVTUODpA7cta2g4y0qFgv5DyiuzX4sWZe/exec";

function upload(){
  const file = document.getElementById("file").files[0];
  const alt  = document.getElementById("alt").value || "gambar";

  if(!file){
    alert("Pilih gambar");
    return;
  }

  document.getElementById("result").innerHTML = "";
  document.getElementById("loader").style.display = "block";

  const reader = new FileReader();
  reader.onloadend = function(){
    fetch(GAS_URL,{
      method:"POST",
      body:JSON.stringify({
        filename:file.name,
        mimeType:file.type,
        data:reader.result.split(",")[1]
      })
    })
    .then(r=>r.text())
    .then(url=>{
      const img = new Image();
      img.src = url;
      img.alt = alt;
      img.loading = "lazy";

      img.onload = function(){
        document.getElementById("loader").style.display = "none";

        const imgCode =
`<img alt="${alt}" src="${url}" loading="lazy"/>`;

        document.getElementById("result").innerHTML = `
          <img src="${url}" style="display:block">
          <textarea rows="3">${imgCode}</textarea>
        `;
      };
    })
    .catch(()=>{
      document.getElementById("loader").style.display="none";
      alert("Upload gagal");
    });
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
