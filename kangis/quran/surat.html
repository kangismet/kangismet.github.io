<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Quran</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f4f6f8;
}

/* HEADER */
header{
  background:#0ea5a4;
  color:#fff;
  text-align:center;
  padding:14px;
}

/* CONTAINER */
.container{
  max-width:850px;
  margin:auto;
  padding:16px;
}

/* AYAT */
.ayat{
  position:relative;
  background:#fff;
  padding:22px 18px 16px 18px;
  border-radius:12px;
  margin-bottom:14px;
  box-shadow:0 2px 4px rgba(0,0,0,.06);
  transition:.2s;
}

.ayat.active{
  background:#e0f7f6;
  border-left:5px solid #0ea5a4;
}

/* NOMOR LINGKARAN */
.nomor{
  position:absolute;
  right:10px;
  top:10px;
  width:34px;
  height:34px;
  border:2px solid #0ea5a4;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:'Amiri Quran';
  font-size:14px;
  background:#fff;
}

/* ARAB */
.arab{
  font-family:'Amiri Quran';
  font-size:30px;
  text-align:right;
  line-height:2.2;
  padding-right:44px;
}

/* TERJEMAH */
.arti{
  margin-top:8px;
  font-size:14px;
  opacity:.85;
}

/* BUTTONS */
.tools{
  position:absolute;
  left:10px;
  top:10px;
  display:flex;
  gap:6px;
}

.tools button{
  border:none;
  padding:6px 8px;
  border-radius:6px;
  cursor:pointer;
}

.play{background:#0ea5a4;color:#fff;}
.book{background:#ffd54f;}

.nav{
  display:flex;
  gap:8px;
  margin-top:20px;
}

.nav button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#0ea5a4;
  color:#fff;
}
</style>
</head>

<body>

<header>
  <h3 id="title">Loading...</h3>
</header>

<div class="container">
  <div id="content"></div>

  <div class="nav">
    <button onclick="go(-1)">⬅ Sebelumnya</button>
    <button onclick="go(1)">Selanjutnya ➡</button>
  </div>
</div>


<script>
const id = parseInt(new URLSearchParams(location.search).get('id')) || 1;

const content = document.getElementById('content');
const titleEl = document.getElementById('title');

let audio = new Audio();

/* angka arab */
function toArabic(n){
  return n.toString().replace(/\d/g,d=>'٠١٢٣٤٥٦٧٨٩'[d]);
}

/* bookmark */
function toggle(key,btn){
  let b=JSON.parse(localStorage.getItem('bookmark')||'[]');
  if(b.includes(key)){
    b=b.filter(x=>x!==key);
    btn.innerText='☆';
  }else{
    b.push(key);
    btn.innerText='★';
  }
  localStorage.setItem('bookmark',JSON.stringify(b));
}

function isBook(key){
  return (JSON.parse(localStorage.getItem('bookmark')||'[]')).includes(key);
}

/* highlight */
function highlight(el){
  document.querySelectorAll('.ayat').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
}

/* load */
async function load(){

  const res = await fetch(`https://equran.id/api/surat/${id}`);
  const data = await res.json();

  titleEl.innerText = `${data.nomor}. ${data.nama_latin}`;

  content.innerHTML="";

  /* AUDIO FULL SURAT (FIX PASTI BUNYI) */
  audio.src =
  `https://equran.nos.wjv-1.neo.id/audio-full/misyari/${String(id).padStart(3,'0')}.mp3`;

  data.ayat.forEach(a=>{

    const key = `${id}:${a.nomor}`;

    const el=document.createElement('div');
    el.className='ayat';

    el.innerHTML=`
      <div class="tools">
        <button class="play">▶</button>
        <button class="book">${isBook(key)?'★':'☆'}</button>
      </div>

      <div class="nomor">${toArabic(a.nomor)}</div>
      <div class="arab">${a.ar}</div>
      <div class="arti">${a.idn}</div>
    `;

    /* play = highlight + play full surat */
    el.querySelector('.play').onclick=()=>{
      audio.play();
      highlight(el);
    }

    el.querySelector('.book').onclick=(e)=>toggle(key,e.target);

    content.appendChild(el);
  });
}

function go(n){
  const next=id+n;
  if(next>=1 && next<=114) location.href=`surat.html?id=${next}`;
}

load();
</script>

</body>
</html>
