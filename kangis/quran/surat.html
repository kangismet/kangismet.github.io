<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Quran</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f4f6f8;
}

/* HEADER */
header{
  background:#0ea5a4;
  color:#fff;
  padding:14px;
  text-align:center;
}

/* CONTAINER */
.container{
  max-width:850px;
  margin:auto;
  padding:16px;
}

/* AYAT CARD */
.ayat{
  background:#fff;
  padding:18px;
  border-radius:12px;
  margin-bottom:12px;
  box-shadow:0 2px 4px rgba(0,0,0,.06);
  position:relative;
  transition:.2s;
}

.ayat.active{
  background:#e0f7f6;
  border-left:5px solid #0ea5a4;
}

/* nomor mushaf */
.nomor{
  font-family:'Amiri Quran';
  font-size:22px;
  text-align:right;
  opacity:.7;
}

/* arab */
.arab{
  font-family:'Amiri Quran';
  font-size:30px;
  text-align:right;
  line-height:2.2;
}

/* arti */
.arti{
  margin-top:8px;
  font-size:14px;
  opacity:.85;
}

/* tombol kecil */
.tools{
  position:absolute;
  left:10px;
  top:10px;
  display:flex;
  gap:6px;
}

.tools button{
  border:none;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

.play{ background:#0ea5a4; color:#fff; }
.book{ background:#ffd54f; }

.nav{
  display:flex;
  justify-content:space-between;
  margin:20px 0;
}

.nav button{
  flex:1;
  margin:0 5px;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#0ea5a4;
  color:#fff;
}
</style>
</head>

<body>

<header>
  <h3 id="title">Loading...</h3>
  <small id="info"></small>
</header>

<div class="container">

  <div id="content"></div>

  <div class="nav">
    <button id="prev">⬅ Sebelumnya</button>
    <button id="next">Selanjutnya ➡</button>
  </div>

</div>

<script>
const id = parseInt(new URLSearchParams(location.search).get('id')) || 1;
const TOTAL = 114;

const content = document.getElementById('content');
const titleEl = document.getElementById('title');
const infoEl = document.getElementById('info');

let audio = new Audio();

/* angka arab */
function toArabic(num){
  return num.toString().replace(/\d/g,d=>'٠١٢٣٤٥٦٧٨٩'[d]);
}

/* bookmark */
function toggleBookmark(key, btn){
  let list = JSON.parse(localStorage.getItem('bookmark')||'[]');

  if(list.includes(key)){
    list = list.filter(x=>x!==key);
    btn.innerText='☆';
  }else{
    list.push(key);
    btn.innerText='★';
  }

  localStorage.setItem('bookmark',JSON.stringify(list));
}

function isBookmarked(key){
  const list = JSON.parse(localStorage.getItem('bookmark')||'[]');
  return list.includes(key);
}

/* highlight */
function highlight(el){
  document.querySelectorAll('.ayat').forEach(a=>a.classList.remove('active'));
  el.classList.add('active');
}

/* load surat */
async function load(){

  const res = await fetch(`https://equran.id/api/surat/${id}`);
  const data = await res.json();

  titleEl.innerText = `${data.nomor}. ${data.nama_latin} (${data.nama})`;
  infoEl.innerText = `${data.jumlah_ayat} Ayat • ${data.tempat_turun}`;

  content.innerHTML="";

  data.ayat.forEach(a=>{

    const el = document.createElement('div');
    el.className='ayat';

    const key = `${id}:${a.nomor}`;

    el.innerHTML=`
      <div class="tools">
        <button class="play">▶</button>
        <button class="book">${isBookmarked(key)?'★':'☆'}</button>
      </div>

      <div class="nomor">۝ ${toArabic(a.nomor)}</div>
      <div class="arab">${a.ar}</div>
      <div class="arti">${a.idn}</div>
    `;

    /* murottal (mishary) */
    const audioUrl =
      `https://everyayah.com/data/Mishary_Rashid_Alafasy_128kbps/${String(id).padStart(3,'0')}${String(a.nomor).padStart(3,'0')}.mp3`;

    el.querySelector('.play').onclick=()=>{
      audio.src = audioUrl;
      audio.play();
      highlight(el);
    }

    el.querySelector('.book').onclick=(e)=>{
      toggleBookmark(key,e.target);
    }

    content.appendChild(el);
  });

}

/* nav */
document.getElementById('prev').onclick=()=>{
  if(id>1) location.href=`surat.html?id=${id-1}`;
}

document.getElementById('next').onclick=()=>{
  if(id<TOTAL) location.href=`surat.html?id=${id+1}`;
}

load();
</script>

</body>
</html>
