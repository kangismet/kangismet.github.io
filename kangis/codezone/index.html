<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CodeZone</title>

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<style>

/* ===============================
   RESET
================================ */
*{
  box-sizing:border-box;
  min-width:0;
  min-height:0;
}

/* ===============================
   BASE
================================ */
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===============================
   HEADER
================================ */
header{
  padding:15px;
  background:#090f24;
  font-weight:600;
  display:flex;
  align-items:center;
}

header h1{
  margin:0;
  font-size:1.5rem;
}

#saveBtn{
  margin-left:auto;
  padding:4px 10px;
  cursor:pointer;
}

/* ===============================
   LAYOUT
================================ */
.main{
  flex:1;
  display:grid;
  grid-template-columns:minmax(0,420px) 1fr;
  background:#020617;
  overflow:hidden;
}

/* ===============================
   EDITOR
================================ */
.editor{
  display:grid;
  grid-template-rows:1fr 1fr 1fr;
  border-right:1px solid #1e293b;
  overflow:hidden;
}

.panel{
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.panel h3{
  margin:0;
  padding:6px 10px;
  font-size:14px;
  background:#020617;
  border-bottom:1px solid #1e293b;
}

.cm-wrapper{
  flex:1;
  overflow:hidden;
}

/* CodeMirror FIX */
.CodeMirror{
  height:100%;
  width:100%;
  font-size:14px;
  overflow:auto;
}

.CodeMirror pre{
  white-space:pre-wrap;
  word-break:break-word;
}

/* ===============================
   RESULT
================================ */
.result-panel{
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.result-wrapper{
  flex:1;
  overflow:hidden;
}

iframe{
  width:100%;
  height:100%;
  border:none;
  background:#fff;
}
textarea#html,textarea#css,textarea#js{background:#212121;border:0;outline:0} 
/* ===============================
   FOOTER
================================ */
footer{
  padding:6px 12px;
  font-size:12px;
  background:#020617;
  border-top:1px solid #1e293b;
  color:#94a3b8;
  text-align:center;
}

/* ===============================
   MOBILE
================================ */
@media(max-width:900px){
  .main{
    grid-template-columns:1fr;
    grid-template-rows:60vh 1fr;
  }
  .editor{
    border-right:none;
    border-bottom:1px solid #1e293b;
  }
}

</style>
</head>

<body>

<header>
  <h1>CodeZone</h1>
  <button id="saveBtn">Save</button>
</header>

<div class="main">

  <!-- EDITOR -->
  <div class="editor">

    <div class="panel">
      <h3>HTML</h3>
      <div class="cm-wrapper">
        <textarea id="html"></textarea>
      </div>
    </div>

    <div class="panel">
      <h3>CSS</h3>
      <div class="cm-wrapper">
        <textarea id="css"></textarea>
      </div>
    </div>

    <div class="panel">
      <h3>JavaScript</h3>
      <div class="cm-wrapper">
        <textarea id="js"></textarea>
      </div>
    </div>

  </div>

  <!-- RESULT -->
  <div class="panel result-panel">
    <h3>Result</h3>
    <div class="result-wrapper">
      <iframe id="result"></iframe>
    </div>
  </div>

</div>

<footer>
  © <span id="year"></span> • Kang Ismet • CodeZone
</footer>


<!-- ===============================
   SCRIPTS
================================ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

<script>
/* ===============================
   YEAR
================================ */
document.getElementById('year').textContent =
  new Date().getFullYear();


/* ===============================
   FILE ID (AUTO DEFAULT)
================================ */
const params = new URLSearchParams(location.search);
const FILE_ID = params.get('file') || 'demo-001';


/* ===============================
   CODEMIRROR
================================ */
const htmlEditor = CodeMirror.fromTextArea(html, {
  mode:'htmlmixed',
  theme:'material-darker',
  lineNumbers:true
});

const cssEditor = CodeMirror.fromTextArea(css, {
  mode:'css',
  theme:'material-darker',
  lineNumbers:true
});

const jsEditor = CodeMirror.fromTextArea(js, {
  mode:'javascript',
  theme:'material-darker',
  lineNumbers:true
});

const result = document.getElementById('result');


/* ===============================
   RUN RESULT
================================ */
function run(){
  const doc = result.contentDocument;

  doc.open();
  doc.write(`<!DOCTYPE html>
<html>
<head>
<style>
html,body{margin:0}
${cssEditor.getValue()}
</style>
</head>
<body>
${htmlEditor.getValue()}
<script>
${jsEditor.getValue()}
<\/script>
</body>
</html>`);
  doc.close();
}

[htmlEditor, cssEditor, jsEditor].forEach(e =>
  e.on('change', run)
);


/* ===============================
   LOAD DEMO (.txt)
================================ */
async function loadDemo(id){
  const res = await fetch(`demo/${id}.txt`);
  const text = await res.text();

  const css  = (text.match(/<style[^>]*>([\s\S]*?)<\/style>/i)||[])[1] || '';
  const js   = (text.match(/<script[^>]*>([\s\S]*?)<\/script>/i)||[])[1] || '';
  const html = (text.match(/<body[^>]*>([\s\S]*?)<\/body>/i)||[])[1] || text;

  htmlEditor.setValue(html.trim());
  cssEditor.setValue(css.trim());
  jsEditor.setValue(js.trim());

  run();
}

/* AUTO LOAD */
loadDemo(FILE_ID);


/* ===============================
   SAVE BUTTON
================================ */
saveBtn.onclick = () => {
  const doc = result.contentDocument;

  const blob = new Blob(
    ['<!DOCTYPE html>\n' + doc.documentElement.outerHTML],
    { type:'text/html' }
  );

  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'result.html';
  a.click();
};
</script>

</body>
</html>

